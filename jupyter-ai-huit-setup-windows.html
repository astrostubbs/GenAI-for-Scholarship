<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jupyter AI Setup with HUIT Bedrock (Windows) â€” Generative AI for Scholarship</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .step-num {
            display: inline-block;
            background: var(--crimson);
            color: white;
            width: 1.7rem;
            height: 1.7rem;
            line-height: 1.7rem;
            text-align: center;
            border-radius: 50%;
            font-weight: bold;
            font-size: 0.85rem;
            margin-right: 0.4rem;
            font-family: -apple-system, Helvetica, Arial, sans-serif;
        }
        .warn-box {
            background: #fff3cd;
            border-left: 4px solid #ff9800;
            padding: 0.8rem 1rem;
            margin: 1rem 0;
            border-radius: 0 4px 4px 0;
        }
        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 0.8rem 1rem;
            margin: 1rem 0;
            border-radius: 0 4px 4px 0;
        }
        .info-box {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 0.8rem 1rem;
            margin: 1rem 0;
            border-radius: 0 4px 4px 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 1rem 0;
        }
        th, td {
            border: 1px solid var(--border);
            padding: 0.5rem 0.8rem;
            text-align: left;
        }
        th {
            background: var(--crimson-dark);
            color: white;
            font-family: -apple-system, Helvetica, Arial, sans-serif;
            font-size: 0.9rem;
        }
        tr:nth-child(even) { background: var(--bg-warm); }
    </style>
</head>
<body>

<header>
    <div class="logos">
        <img src="HDSI.png" alt="Harvard Data Science Initiative">
        <img src="FAS.png" alt="Harvard Faculty of Arts and Sciences">
    </div>
    <h1>Generative AI for Scholarship</h1>
    <div class="sponsors">Harvard Data Science Initiative (HDSI) &amp; Faculty of Arts and Sciences (FAS)</div>
</header>

<nav>
    <a href="index.html">Home</a>
    <a href="session1-foundation.html">The Basics</a>
    <a href="session2-coder.html">The AI-Empowered Coder</a>
    <a href="session3-power-user.html">Claude Code CLI</a>
    <a href="site-map.html">Site Map</a>
    <a href="https://datascience.harvard.edu/education/generative-ai-for-graduate-students-and-postdocs/" target="_blank">Other GAI Sessions</a>
</nav>

<div class="disclaimer" style="background: #d4edda; border-left: 4px solid #28a745; text-align: center; padding: 1rem;">
    <strong style="font-size: 1.1rem;">API Key for This Session</strong><br>
    The key will be posted shortly before the session and will work until midnight on the day of the session.<br>
    <a href="https://code.harvard.edu/dal470/keytest/blob/main/key.txt" target="_blank"
       style="display: inline-block; background: #A51C30; color: white; padding: 0.5rem 1.5rem; text-decoration: none; border-radius: 4px; font-weight: bold; margin-top: 0.5rem;">
        Retrieve API Key (Harvard Key required)
    </a>
</div>

<h2>Setting Up Jupyter AI with the Harvard HUIT Bedrock Endpoint (Windows)</h2>

<p>
    This guide walks through configuring <strong>Jupyter AI</strong> (the JupyterLab AI chat assistant)
    to route queries through Harvard's HUIT Bedrock proxy on Windows.
</p>

<div class="info-box">
    <strong>Mac users:</strong> See the
    <a href="jupyter-ai-huit-setup.html"><strong>Mac setup guide</strong></a> instead.
</div>

<div class="info-box">
    <strong>Prerequisite:</strong> You need a valid HUIT API key for the Bedrock proxy.
    For the workshop, use the API key from the link at the top of this page.
    <p style="margin: 0.5rem 0 0 0;">
        After the workshop, see <a href="setting-up-claude-code.html">Setting Up Anthropic API Access for Harvard Users</a>
        for instructions on obtaining your own key.
    </p>
</div>

<!-- Step 1 -->
<h2><span class="step-num">1</span> Create Your Working Directory</h2>

<p>Open <strong>Terminal</strong> from the Start menu and create a directory for this work:</p>

<pre><code>mkdir "$env:USERPROFILE\Desktop\GAI\exercises"
cd "$env:USERPROFILE\Desktop\GAI\exercises"</code></pre>

<p>You will run all subsequent commands from this directory.</p>

<!-- Step 2 -->
<h2><span class="step-num">2</span> Verify Your Python Version</h2>

<p>Ensure Python 3.10 or later is installed:</p>

<pre><code>python --version
# Expected: Python 3.13.x (or 3.10+)</code></pre>

<p>
    If Python is not installed or the version is too old, download it from
    <a href="https://www.python.org/downloads/" target="_blank">python.org</a>.
</p>

<!-- Step 3 -->
<h2><span class="step-num">3</span> Create a Virtual Environment</h2>

<p>
    Jupyter AI v3 is beta software that can pull in dependency versions incompatible with
    your existing Python packages. A <strong>virtual environment</strong> keeps everything
    isolated so nothing else on your system is affected.
</p>

<pre><code>python -m venv jupyter-ai-env</code></pre>

<p>Activate it:</p>

<pre><code>.\jupyter-ai-env\Scripts\Activate.ps1</code></pre>

<p>
    Your terminal prompt should now show <code>(jupyter-ai-env)</code> at the beginning,
    confirming the virtual environment is active.
</p>

<div class="warn-box">
    <strong>If you get a script execution error:</strong> Run
    <code>Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser</code>
    and type <strong>Y</strong> to confirm, then try activating again.
</div>

<div class="warn-box">
    <strong>Remember:</strong> You must activate this virtual environment every time you open
    a new terminal window before launching JupyterLab:
    <pre><code>cd "$env:USERPROFILE\Desktop\GAI\exercises"
.\jupyter-ai-env\Scripts\Activate.ps1</code></pre>
</div>

<!-- Step 4 -->
<h2><span class="step-num">4</span> Install JupyterLab</h2>

<p>With the virtual environment active, install JupyterLab:</p>

<pre><code>pip install notebook jupyterlab</code></pre>

<p>Verify the installation and launch JupyterLab to confirm it works:</p>

<pre><code>jupyter lab</code></pre>

<p>Close it (Ctrl+C in the terminal) once you've confirmed it launches, then continue to the next step.</p>

<!-- Step 5 -->
<h2><span class="step-num">5</span> Install Jupyter AI (v3 Beta)</h2>

<p>
    The HUIT proxy speaks the <strong>AWS Bedrock Converse API</strong> format. Jupyter AI v3 uses
    <strong>LiteLLM</strong> as its backend, which has native support for Bedrock endpoints with
    Bearer token authentication. This is why v3 (beta) is required instead of the stable v2 release.
</p>

<pre><code>pip install "jupyter-ai==3.0.0b9" boto3</code></pre>

<p>Verify:</p>

<pre><code>pip show jupyter-ai
# Expected: Version: 3.0.0b9</code></pre>

<div class="warn-box">
    <strong>Beta software:</strong> Version 3.0.0b9 is a pre-release. The UI and configuration
    may change in future stable releases. This guide was tested with this specific version.
</div>

<!-- Step 6 -->
<h2><span class="step-num">6</span> Configure Environment Variables</h2>

<p>
    Set the following environment variables in your terminal.
    Replace <code>your-huit-api-key-here</code> with the API key from the link at the top of this page.
</p>

<pre><code>$env:ANTHROPIC_API_KEY = "your-huit-api-key-here"
$env:ANTHROPIC_BEDROCK_BASE_URL = "https://apis.huit.harvard.edu/ais-bedrock-llm/v2"
$env:AWS_BEARER_TOKEN_BEDROCK = "your-huit-api-key-here"</code></pre>

<p>Verify they are set:</p>

<pre><code>echo $env:AWS_BEARER_TOKEN_BEDROCK
echo $env:ANTHROPIC_API_KEY
# Both should print your API key</code></pre>

<div class="info-box">
    <strong>Why <code>AWS_BEARER_TOKEN_BEDROCK</code>?</strong> LiteLLM's Bedrock handler checks
    this variable to decide whether to use Bearer token authentication (your HUIT API key) or
    standard AWS SigV4 signing (which requires IAM credentials you don't have). Without it,
    you'll get "Unable to locate credentials."
</div>

<div class="warn-box">
    <strong>Note:</strong> These environment variables only last for the current terminal session.
    To make them permanent, see the
    <a href="#make-permanent">Making Environment Variables Permanent</a> section below.
</div>

<!-- Step 7 -->
<h2><span class="step-num">7</span> Launch JupyterLab</h2>

<p>With the environment variables set and the virtual environment active, launch JupyterLab:</p>

<pre><code>jupyter lab</code></pre>

<p>
    If you opened a new terminal, you need to set the environment variables and
    activate the venv again first:
</p>

<pre><code>cd "$env:USERPROFILE\Desktop\GAI\exercises"
.\jupyter-ai-env\Scripts\Activate.ps1
$env:ANTHROPIC_API_KEY = "your-huit-api-key-here"
$env:ANTHROPIC_BEDROCK_BASE_URL = "https://apis.huit.harvard.edu/ais-bedrock-llm/v2"
$env:AWS_BEARER_TOKEN_BEDROCK = "your-huit-api-key-here"
jupyter lab</code></pre>

<!-- Step 8 -->
<h2><span class="step-num">8</span> Configure Jupyternaut Settings</h2>

<p>In the JupyterLab interface, open the Jupyternaut (AI assistant) settings panel.</p>

<h3>8a. Find Settings</h3>
<p>Look for the Jupyternaut settings. In v3, this may be accessible via:</p>
<ul class="resources">
    <li>The menu bar: <strong>Settings &rarr; AI Settings</strong></li>
    <li>The Jupyternaut icon in the left sidebar &rarr; settings gear</li>
</ul>

<h3>8b. Set the Chat Model ID</h3>
<p>In the <strong>Chat model ID</strong> field, enter:</p>

<pre><code>bedrock/converse/us.anthropic.claude-opus-4-5-20251101-v1:0</code></pre>

<div class="info-box">
    <strong>Model ID format:</strong> The <code>bedrock/converse/</code> prefix tells LiteLLM to use
    the Bedrock Converse API handler, which correctly constructs the endpoint URL and supports
    Bearer token auth. Do <strong>not</strong> use <code>bedrock/converse_like/</code> &mdash; it has
    URL construction issues with custom endpoints.
</div>

<h3>8c. Set Model Parameters</h3>
<p>In the <strong>Model parameters</strong> section, add:</p>

<table>
    <tr>
        <th>Parameter Name</th>
        <th>Type</th>
        <th>Value</th>
    </tr>
    <tr>
        <td><code>api_base</code></td>
        <td>string</td>
        <td><code>https://apis.huit.harvard.edu/ais-bedrock-llm/v2</code></td>
    </tr>
</table>

<h3>8d. Verify API Key</h3>
<p>
    In the <strong>Secrets and API keys</strong> section, confirm that
    <code>AWS_BEARER_TOKEN_BEDROCK</code> appears as a static (read-only) secret
    imported from your environment. If it doesn't appear, add it using the "Add secret" button.
</p>

<h3>8e. Embedding Model</h3>
<p>Leave the <strong>Embedding model</strong> blank. It is only needed for the <code>/learn</code>
document indexing feature and is not required for chat.</p>

<h3>8f. Save and Test</h3>
<p>Click <strong>Update chat model</strong>, then send a test message in the Jupyternaut chat:</p>

<pre><code>Hello, can you tell me what model you are?</code></pre>

<div class="success-box">
    <strong>Expected result:</strong> You should receive a response from Claude via the HUIT proxy.
</div>

<!-- Models -->
<h2>Available Models</h2>

<p>Change the model ID in Jupyternaut settings to use different models:</p>

<table>
    <tr>
        <th>Model</th>
        <th>Chat Model ID</th>
    </tr>
    <tr>
        <td>Claude Opus 4.5</td>
        <td><code>bedrock/converse/us.anthropic.claude-opus-4-5-20251101-v1:0</code></td>
    </tr>
    <tr>
        <td>Claude Opus 4.6</td>
        <td><code>bedrock/converse/us.anthropic.claude-opus-4-6-v1:0</code></td>
    </tr>
    <tr>
        <td>Claude Sonnet 4</td>
        <td><code>bedrock/converse/us.anthropic.claude-sonnet-4-20250514-v1:0</code></td>
    </tr>
    <tr>
        <td>Claude Haiku 3.5</td>
        <td><code>bedrock/converse/us.anthropic.claude-3-5-haiku-20241022-v1:0</code></td>
    </tr>
</table>

<!-- Troubleshooting -->
<h2>Troubleshooting</h2>

<h3>"Unable to locate credentials"</h3>
<p>
    LiteLLM is trying AWS SigV4 auth instead of Bearer token auth.
    Ensure <code>AWS_BEARER_TOKEN_BEDROCK</code> is set in the same terminal
    session where you launched JupyterLab.
</p>

<h3>"Invalid ApiKey" (oauth.v2.InvalidApiKey)</h3>
<p>
    Verify that <code>AWS_BEARER_TOKEN_BEDROCK</code> is set to the correct HUIT API key
    (same value as <code>ANTHROPIC_API_KEY</code>).
</p>

<h3>Script execution policy error when activating venv</h3>
<p>Run this once to allow scripts for your user account:</p>
<pre><code>Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser</code></pre>
<p>Type <strong>Y</strong> and press Enter to confirm.</p>

<h3>No response / silent failure</h3>
<p>Check the terminal where you launched <code>jupyter lab</code> for error tracebacks. Common causes:</p>
<ul class="resources">
    <li>Wrong model ID format (must start with <code>bedrock/converse/</code>)</li>
    <li>Missing <code>api_base</code> model parameter in Jupyternaut settings</li>
    <li>Environment variables not set in the current terminal session</li>
</ul>

<!-- Make permanent -->
<h2 id="make-permanent">Making Environment Variables Permanent (Optional)</h2>

<p>
    To avoid re-entering environment variables every time you open a terminal,
    you can add them to your PowerShell profile:
</p>

<pre><code># Create the profile file if it doesn't exist
if (!(Test-Path -Path $PROFILE)) { New-Item -Type File -Path $PROFILE -Force }

# Open it in Notepad
notepad $PROFILE</code></pre>

<p>Add these lines to the profile file (with your actual API key), save, and close:</p>

<pre><code>$env:ANTHROPIC_API_KEY = "your-huit-api-key-here"
$env:ANTHROPIC_BEDROCK_BASE_URL = "https://apis.huit.harvard.edu/ais-bedrock-llm/v2"
$env:AWS_BEARER_TOKEN_BEDROCK = "your-huit-api-key-here"</code></pre>

<p>The variables will be set automatically every time you open a terminal.</p>

<footer>
    <p>
        Last updated: February 2026. Tested with Python 3.13, jupyter-ai 3.0.0b9, Windows 11.
    </p>
    <p>
        &copy; 2026 President and Fellows of Harvard College.
        Licensed under
        <a href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a>.
    </p>
</footer>

<script data-goatcounter="https://genaiatfas.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
</body>
</html>
